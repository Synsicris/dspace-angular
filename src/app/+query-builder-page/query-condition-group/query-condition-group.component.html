<div class="container query-group-container" *ngIf="searchConfig">
  <form [formGroup]="formGroup">
    <div class="row">
      <div class="col-md-3">
        <ng-select
          formControlName="defaultFilter"
          class="px-0"
          [virtualScroll]="true"
          [clearable]="false"
          placeholder="Select value"
          (change)="onDefaultValueSelect($event)"
          (open)="onFirstDropdownOpen()"
        >
          <ng-option
            *ngFor="let value of firstDefaultValues"
            [value]="value.value"
            [disabled]="value.disable"
          >
            {{ value.label | titlecase }}
          </ng-option>
        </ng-select>
      </div>
      <div class="col-md-9">
        <div
          formArrayName="queryGroup"
          class="row mb-2"
          *ngFor="
            let queryStatement of queryGroup.controls;
            let i = index;
            let isLast = last
          "
        >
          <!-- FormGroup -->
          <div class="w-100 d-flex" [formGroupName]="i">
            <!--
         TODO: search()
         TODO: (scroll)
         TODO: loading ??
        -->
            <ng-select
              formControlName="filter"
              class="col-md-3 px-0 mr-1"
              [virtualScroll]="true"
              [clearable]="false"
              placeholder="select value"
              (change)="onFilterSelect($event, 1, i)"
            >
              <ng-option
                *ngFor="let filter of secondColumnFilters"
                [value]="filter.name"
              >
                {{ "explore.index." + filter.name | translate }}
              </ng-option>
            </ng-select>

            <ng-select
              formControlName="value"
              class="col-md-3 px-0 mr-1"
              [virtualScroll]="true"
              [clearable]="false"
              placeholder="select value"
              (change)="
                onValueSelect($event, queryGroup.get(i + '.filter')?.value)
              "
              (scrollToEnd)="onValuesScroll(queryGroup.get(i + '.filter')?.value, i)"
              (search)="searchValue($event)"
            >
              <ng-option
                *ngFor="
                  let value of filterValuesMap.get(
                    queryGroup.get(i + '.filter')?.value
                  )
                "
                [value]="value.label"
                [disabled]="value.disable"
              >
                {{ value.label | titlecase }}
              </ng-option>
            </ng-select>

            <button
              [disabled]="!queryGroup.get(i + '.value')?.value"
              *ngIf="isLast"
              id="addButton"
              type="button"
              class="btn btn-dark col-md-2 ml-1"
              (click)="addQueryStatement()"
            >
              <i class="fa fa-plus"></i> Add Filter
            </button>

            <div class="col-1 text-right" *ngIf="!isLast">
              <span>AND</span>
            </div>

            <div class="col-1 p-0 text-right" *ngIf="!isLast">
              <button
                id="deleteButton"
                type="button"
                class="btn btn-danger"
                (click)="deleteCondition(i)"
              >
                <i aria-hidden="true" class="fa fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
