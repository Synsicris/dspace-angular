<div class="border-bottom mb-4 pb-2 d-flex justify-content-between align-items-center">
  <ds-comcol-page-header [name]="impactPathway.title">
  </ds-comcol-page-header>
  <ds-view-version-badges *ngIf="impactPathWayItem" [item]="impactPathWayItem"></ds-view-version-badges>
  <div class="pl-2 space-children-mr">
    <ds-item-version-list [btnClass]="'btn-md'"
                          [showOnlyVisible]="isFunder"
                          [targetItemId]="impactPathway.id"
                          (versionSelected)="onVersionSelected($event)"
                          (versionDeselected)="onVersionDeselected()">
    </ds-item-version-list>
    <button *ngIf="(canDeleteImpactPathway$ | async)" class="btn btn-danger" title="{{'impact-pathway.remove.title' | translate}}"
            [disabled]="(isProcessingRemove() | async) || (compareMode | async) || (isVersionOfAnItem$| async)"
            (click)="$event.preventDefault(); confirmRemove(content); $event.stopPropagation()">
      <span *ngIf="!(isProcessingRemove() | async)">
        <i class="far fa-trash-alt"></i> {{'impact-pathway.remove.title' | translate}}
      </span>
      <span *ngIf="(isProcessingRemove() | async)">
        <i class="fas fa-circle-notch fa-spin"> {{'impact-pathway.remove.processing' | translate}}</i>
      </span>
    </button>
    <button class="btn btn-primary" title="{{'impact-pathway.edit.title' | translate}}"
            [disabled]="(isProcessingRemove() | async) || (compareMode | async) || !(canEditButton$ | async) || (isVersionOfAnItem$| async)"
            (click)="$event.preventDefault(); openEditModal(); $event.stopPropagation()">
      <span *ngIf="!(isProcessingRemove() | async)">
        <i class="far fa-edit"></i> {{'impact-pathway.edit.title' | translate}}
      </span>
      <span *ngIf="(isProcessingRemove() | async)">
        <i class="fas fa-circle-notch fa-spin"> {{'impact-pathway.remove.processing' | translate}}</i>
      </span>
    </button>
  </div>
</div>

<div>
  <ds-alert *ngIf="infoShowed | async" [type]="'alert-info'" [collapsible]="true"
    [content]="'impact-pathway.wrapper.info'"></ds-alert>
    <ng-container *ngIf="(isVersionOfAnItem$ | async)">
      <div class="mb-3">
        <ngb-accordion
          #accordionRef
          [destroyOnHide]="false"
          [closeOthers]="false"
          activeIds=""
        >
          <ngb-panel id="panel-0">
            <ng-template ngbPanelHeader let-opened="opened">
              <span> {{'comment-list.header' | translate}} </span>
              <div class="d-inline-block float-right">
                <button ngbPanelToggle class="btn btn-outline-light">
                  <i *ngIf="opened" class="fa fa-chevron-up text-dark"></i>
                  <i *ngIf="!opened" class="fa fa-chevron-down text-dark"></i>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <div class="row" *ngIf="(formConfig$ | async)?.name">
                <div class="col-2 p-0" *ngFor="let data of impactPathway.steps | dsGetIpwData">
                  <ds-comment-list
                    [relatedEntityType]="entityType"
                    [itemUuid]="data.id"
                    [title]="data.title"
                    [projectCommunityId]="projectCommunityId"
                    [type]="(formConfig$ | async).name">
                 </ds-comment-list>
                </div>
              </div>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </div>
    </ng-container>
   <div class="d-flex align-items-stretch p-0 m-0 mb-3 vertical-content border">
    <ipw-impact-path-way-step *ngFor="let step of impactPathway.steps" ipwStepColor class="vertical-step"
                              [projectCommunityId]="projectCommunityId"
                              [impactPathwayId]="impactPathway.id"
                              [impactPathwayStepId]="step.id"
                              [stepType]="step.type"
                              [allImpactPathwayStepIds]="getImpactPathwayStepIds()"
                              [compareMode]="(compareMode | async)"
                              [isVersionOfAnItem]="(isVersionOfAnItem$ | async)"></ipw-impact-path-way-step>
  </div>
  <ipw-editable-textarea *ngIf="impactPathway"
                         [editMode]="getEditMode()"
                         [formConfig]="formConfig$"
                         [formSectionName]="getSectionName()"
                         [itemId]="impactPathway.id"
                         [editTitle]="'impact-pathway.edit.title' | translate"
                         [fieldTitle]="'impact-pathway.description' | translate"
                         [content]="impactPathway.description"
                         [disabled]="(compareMode | async) || !(canEditButton$ | async)"
                         (contentChange)="updateImpactPathway($event)">
  </ipw-editable-textarea>
</div>

<div *ngIf="(loaded | async)">
  <ngx-domarrow *ngFor="let relation of (getRelations() | async)"
                [from]="'#' + relation.from"
                [to]="'#' + relation.to"
                [head]="relation.twoWay"
                [tail]="true"
                [onlyVisible]="true" color="red"></ngx-domarrow>
</div>

<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title text-danger">{{'impact-pathway.remove.confirm.title' | translate}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('cancel')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>{{'impact-pathway.remove.confirm.info' | translate}}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" title="{{'impact-pathway.remove.confirm.cancel' | translate}}" (click)="c('cancel')">
      {{'impact-pathway.remove.confirm.cancel' | translate}}
    </button>
    <button type="button" class="btn btn-danger" title="{{'impact-pathway.remove.confirm.submit' | translate}}" (click)="c('ok')">
      {{'impact-pathway.remove.confirm.submit' | translate}}
    </button>
  </div>
</ng-template>
