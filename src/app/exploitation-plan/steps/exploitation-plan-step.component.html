<ipw-collapsable-panel #ipwCollapse class="d-block mb-3"
                       [sidebarPanelTitle]="getStepTitle()"
                       [startOpen]="!(isCollapsed() | async)"
                       [collapsable]="true">
  <ng-container ngProjectAs="panelIconTitle">
    <i ipwExploitationPlanIcon [exploitationPlanType]="exploitationPlanStep?.type"></i>
  </ng-container>
  <ng-container ngProjectAs="panelContent">
    <div class="d-flex">
      <div #exploitationSection class="pr-0 w-100">
        <div class="p-2">
          <ds-alert [type]="'alert-info'" [content]="'exploitation-plan.' + exploitationPlanStep?.type + '.info.text'"
                    [collapsible]="true"></ds-alert>
          <div class="p-0 m-0 mb-2 bg-light rounded">
            <ipw-exploitation-plan-step-container [exploitationPlanStep]="exploitationPlanStep"
                                                  [isVersionOfAnItem]="isVersionOfAnItem"
                                                  [projectCommunityId]="projectCommunityId"
                                                  [fundingCommunity]="fundingCommunity"
                                                  [compareMode]="compareMode"></ipw-exploitation-plan-step-container>
          </div>
          <ds-view-simple-item-form *ngIf="hasCheckbox && exploitationPlanStep"
                                    [editMode]="getEditMode()"
                                    [editTitle]="'exploitation-plan.edit.btn.title' | translate"
                                    [fieldTitle]="'exploitation-plan.description.title' | translate"
                                    [formConfig]="formConfig$"
                                    [formSectionName]="getSectionName()"
                                    [itemId]="exploitationPlanStep.id"
                                    [disabled]="compareMode || isVersionOfAnItem"
                                    (itemUpdate)="updateExploitationPlanStep($event)"></ds-view-simple-item-form>
          <ipw-editable-textarea *ngIf="!hasCheckbox && exploitationPlanStep"
                                 [editMode]="getEditMode()"
                                 [formConfig]="formConfig$"
                                 [formSectionName]="getSectionName()"
                                 [itemId]="exploitationPlanStep.id"
                                 [editTitle]="'exploitation-plan.edit.btn.title' | translate"
                                 [fieldTitle]="'exploitation-plan.description.title' | translate"
                                 [content]="exploitationPlanStep.description"
                                 [disabled]="compareMode || isVersionOfAnItem"
                                 (contentChange)="updateExploitationPlanStep($event)"></ipw-editable-textarea>
        </div>
      </div>

      <div *ngIf="isVersionOfAnItem && isFunder && (formConfig$ | async)?.name" class="comment-box pr-2 py-2 comment-box-position"
           [ngStyle]="{'height.px': exploitationSection.clientHeight}">
        <ds-comment-list
          [relatedEntityType]="(exploitationPlan$ | async).entityType"
          [itemUuid]="this.exploitationPlanStep.id"
          [projectCommunityId]="projectCommunityId"
          [type]="(formConfig$ | async).name">
        </ds-comment-list>
      </div>
    </div>
  </ng-container>
</ipw-collapsable-panel>
