import { findIndex, remove } from 'lodash';

import { ExploitationPlanTask } from './exploitation-plan-task.model';

export class ExploitationPlanStep {

  constructor(
    public parentId?: string,
    public id?: string,
    public type?: string,
    public description?: string,
    public tasks: ExploitationPlanTask[] = []) {
  }

  hasTask(taskId: string) {
    return (findIndex(this.tasks, { id: taskId }) !== -1);
  }

  getTask(taskId: string): ExploitationPlanTask {
    let step = null;
    const index = this.getTaskIndex(taskId);
    if (index !== -1) {
      step = this.tasks[index];
    }

    return step;
  }

  getTasksIds(): string[] {
    const tasksIds: string[] = this.tasks.map((task) => task.id);

    return tasksIds;
  }

  getTaskIndex(taskId: string): number {
    return findIndex(this.tasks, { id: taskId });
  }

  removeTask(taskId: string) {
    this.tasks = remove(this.tasks, (innerTask) => {
      return innerTask.id !== taskId;
    });
  }

  replaceTask(taskId: string, newTask: ExploitationPlanTask) {
    const index = this.getTaskIndex(taskId);
    this.tasks[index] = newTask;
  }

  setTasks(tasks: ExploitationPlanTask[]) {
    this.tasks = [...tasks];
  }

}
